//
//  FeedsSplitViewController.m
//  SplitView
//
//  Created by Hadar Porat on 3/27/11.
//  Copyright 2011 Kosher Penguin LLC. All rights reserved.
//

#import "SplitViewController.h"

#import "PrimaryViewController.h"

///////////////////////////////////////////////////////////////////////////////////////////////////
///////////////////////////////////////////////////////////////////////////////////////////////////
///////////////////////////////////////////////////////////////////////////////////////////////////
@interface SplitViewController()

- (void)setupURLRouting;

@end



///////////////////////////////////////////////////////////////////////////////////////////////////
///////////////////////////////////////////////////////////////////////////////////////////////////
///////////////////////////////////////////////////////////////////////////////////////////////////
@implementation SplitViewController


///////////////////////////////////////////////////////////////////////////////////////////////////
- (id)initWithNibName:(NSString *)nibNameOrNil bundle:(NSBundle *)nibBundleOrNil {
  if ((self = [super initWithNibName:nibNameOrNil bundle:nibBundleOrNil])) {
    [self setupURLRouting];
  }
  
  return self;
}


///////////////////////////////////////////////////////////////////////////////////////////////////
- (void)viewWillAppear:(BOOL)animated {
  [super viewWillAppear:animated];
  
  [self.primaryNavigator openURLs: @"tt://primary", nil];
}

///////////////////////////////////////////////////////////////////////////////////////////////////
- (void)viewDidLoad {
  [self.detailsNavigator openURLs: @"tt://details/item1", nil];
  
}


///////////////////////////////////////////////////////////////////////////////////////////////////
- (BOOL)shouldAutorotateToInterfaceOrientation:(UIInterfaceOrientation)interfaceOrientation {
  return YES;
}


///////////////////////////////////////////////////////////////////////////////////////////////////
- (id)willOpenUrlPath:(NSURL*)url {
  [self.detailsNavigator openURLAction:[TTURLAction actionWithURLPath:[url absoluteString]]];
  [self.popoverSplitController dismissPopoverAnimated:YES];
  
  [self updateSplitViewButton];
  
  return nil;
}


///////////////////////////////////////////////////////////////////////////////////////////////////
- (void)routePrimaryNavigator {

  TTURLMap* map = self.primaryNavigator.URLMap;

  // Forward all unhandled URL actions to the right navigator.
  [map from: @"*" toObject: self selector: @selector(willOpenUrlPath:)];
  
  [map from:@"tt://primary" toViewController:[PrimaryViewController class]];
}


///////////////////////////////////////////////////////////////////////////////////////////////////
- (void)routeDetailsNavigator {
  TTURLMap* map = self.detailsNavigator.URLMap;
  [map from: @"*" toViewController:[TTWebController class]];
}


///////////////////////////////////////////////////////////////////////////////////////////////////
- (void)setupURLRouting {
  [self routePrimaryNavigator];
  [self routeDetailsNavigator];
}


@end
